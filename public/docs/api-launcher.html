<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docs API - Pasteler√≠a 1000 Sabores</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #fff0f5; /* Un fondo rosado suave estilo pasteler√≠a */
        }
        .container { 
            max-width: 600px; 
            margin: 50px auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            text-align: center; 
            border-top: 5px solid #d63384; /* Borde superior color frambuesa */
        }
        h1 { color: #d63384; }
        .btn { 
            background: #d63384; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 25px; 
            cursor: pointer; 
            font-size: 16px; 
            text-decoration: none; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px; 
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .btn:hover { background: #a61e61; transform: translateY(-2px); }
        .loading { display: none; color: #6c757d; margin-top: 15px; }
        .instructions { 
            background: #fffbf0; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px 0; 
            text-align: left; 
            border: 1px solid #ffeeba;
        }
        .instructions li { margin-bottom: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç∞ API Pasteler√≠a 1000 Sabores</h1>
        <p>Lanzador de documentaci√≥n t√©cnica para el sistema de gesti√≥n.</p>
        
        <div class="instructions">
            <h3>Instrucciones:</h3>
            <ol>
                <li>Haz clic en <strong>"Copiar YAML"</strong> (bot√≥n verde).</li>
                <li>Haz clic en <strong>"Abrir Swagger Editor"</strong>.</li>
                <li>En la nueva pesta√±a, selecciona todo el texto de la izquierda y b√≥rralo.</li>
                <li><strong>Pega (Ctrl+V)</strong> el contenido que acabas de copiar.</li>
                <li>¬°Listo! Ver√°s la documentaci√≥n de tus tortas y pedidos.</li>
            </ol>
        </div>
        
        <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
            <button id="copyBtn" class="btn" onclick="copyYAMLContent()" style="background: #198754;">
                <i>üìÑ</i> Copiar YAML
            </button>

            <button id="launchBtn" class="btn" onclick="launchSwaggerEditor()">
                <i>üöÄ</i> Abrir Swagger Editor
            </button>
        </div>
        
        <div id="loading" class="loading">
            <p>Procesando...</p>
        </div>

        <div id="status" style="margin-top: 20px; font-weight: bold; min-height: 24px;"></div>

        <div style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; font-size: 0.9em; color: #666;">
            <p>Documentaci√≥n adaptada para el proyecto GitHub: <strong>Pasteleria-1000-Sabores-caso-3</strong></p>
        </div>
    </div>

    <script>
        // Contenido YAML adaptado para la Pasteler√≠a
        const openapiContent = `openapi: 3.0.0
info:
  title: API Panel de Administraci√≥n - Pasteler√≠a 1000 Sabores
  description: Documentaci√≥n de servicios Firebase Firestore para el sistema de gesti√≥n de la pasteler√≠a.
  version: 1.0.0
  contact:
    name: Soporte Pasteler√≠a
    email: contacto@pasteleria1000sabores.com

servers:
  - url: https://firestore.googleapis.com/v1
    description: Firebase Firestore API

tags:
  - name: Dashboard
    description: M√©tricas de ventas y producci√≥n
  - name: Productos
    description: Gesti√≥n del cat√°logo de pasteles y dulces
  - name: √ìrdenes
    description: Gesti√≥n de pedidos de clientes
  - name: Usuarios
    description: Gesti√≥n de clientes y administradores
  - name: Categor√≠as
    description: Gesti√≥n de tipos de productos (Tortas, Galletas, etc.)

paths:
  /api/dashboard/estadisticas:
    get:
      tags:
        - Dashboard
      summary: Obtener estad√≠sticas generales
      description: Servicio Firebase - DashboardService.getEstadisticasCompletas()
      responses:
        '200':
          description: Estad√≠sticas obtenidas correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EstadisticasDashboard'
              example:
                totalCompras: 45
                proyeccionCompras: 60
                totalProductos: 32
                inventarioTotal: 150
                totalUsuarios: 120
                nuevosUsuariosMes: 15

  /api/productos:
    get:
      tags:
        - Productos
      summary: Obtener cat√°logo de pasteler√≠a
      description: Servicio Firebase - CrudService.getProductos()
      responses:
        '200':
          description: Lista de productos obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Producto'
              example:
                - id: "prod_torta_01"
                  nombre: "Torta Tres Leches"
                  precio: 18500
                  stock: 8
                  categoria: "Tortas Tradicionales"
                  imagen: "https://ejemplo.com/tres-leches.jpg"
                  activo: true
                - id: "prod_galleta_02"
                  nombre: "Caja Galletas Finas (12u)"
                  precio: 6500
                  stock: 20
                  categoria: "Galletas"
                  imagen: "https://ejemplo.com/galletas-finas.jpg"
                  activo: true
                - id: "prod_kuchen_03"
                  nombre: "Kuchen de Nuez"
                  precio: 12000
                  stock: 5
                  categoria: "Kuchen y Tartas"
                  activo: true

    post:
      tags:
        - Productos
      summary: Crear un nuevo producto
      description: Servicio Firebase - CrudService.createProducto()
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductoInput'
            example:
              nombre: "Torta Selva Negra"
              precio: 22000
              stock: 4
              categoria: "Tortas Premium"
              imagen: "https://ejemplo.com/selva-negra.jpg"
      responses:
        '201':
          description: Producto creado correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
              example:
                id: "nuevoIdGeneradoFirestore_pastel1"

  /api/productos/{id}:
    get:
      tags:
        - Productos
      summary: Obtener producto por ID
      description: Servicio Firebase - CrudService.getProductoById()
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "prod_torta_01"
      responses:
        '200':
          description: Producto encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Producto'
              example:
                id: "prod_torta_01"
                nombre: "Torta Tres Leches"
                precio: 18500
                stock: 8
                categoria: "Tortas Tradicionales"
                imagen: "https://ejemplo.com/tres-leches.jpg"
                activo: true
        '404':
          description: Producto no encontrado
          content:
            application/json:
              example:
                error: "Producto no encontrado"
                message: "El producto con ID prod_torta_01 no existe"

    put:
      tags:
        - Productos
      summary: Actualizar producto existente
      description: Servicio Firebase - CrudService.updateProducto()
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "prod_torta_01"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductoInput'
            example:
              nombre: "Torta Tres Leches (Grande)"
              precio: 20000
              stock: 10
              categoria: "Tortas Tradicionales"
      responses:
        '200':
          description: Producto actualizado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Producto actualizado correctamente"
        '404':
          description: Producto no encontrado

    delete:
      tags:
        - Productos
      summary: Eliminar producto del cat√°logo
      description: Servicio Firebase - CrudService.deleteProducto()
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "prod_torta_01"
      responses:
        '200':
          description: Producto eliminado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Producto eliminado correctamente"
        '404':
          description: Producto no encontrado

  /api/ordenes:
    get:
      tags:
        - √ìrdenes
      summary: Obtener lista de pedidos
      description: Servicio Firebase - CrudService.getOrdenes()
      responses:
        '200':
          description: Lista de √≥rdenes obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Orden'
              example:
                - id: "orden_001"
                  clienteNombre: "Juan P√©rez"
                  total: 25000
                  estado: "completado"
                  fecha: "2024-05-15T10:30:00Z"
                  productos:
                    - id: "prod_torta_01"
                      nombre: "Torta Tres Leches"
                      cantidad: 1
                      precio: 18500
                    - id: "prod_galleta_02"
                      nombre: "Caja Galletas Finas"
                      cantidad: 1
                      precio: 6500
                - id: "orden_002"
                  clienteNombre: "Mar√≠a Garc√≠a"
                  total: 44000
                  estado: "procesando"
                  fecha: "2024-05-14T15:45:00Z"
                  productos:
                    - id: "prod_selva_05"
                      nombre: "Torta Selva Negra"
                      cantidad: 2
                      precio: 22000

  /api/ordenes/{id}:
    get:
      tags:
        - √ìrdenes
      summary: Obtener orden por ID
      description: Servicio Firebase - CrudService.getOrdenById()
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "orden_001"
      responses:
        '200':
          description: Orden encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Orden'
              example:
                id: "orden_001"
                clienteNombre: "Juan P√©rez"
                total: 25000
                estado: "completado"
                fecha: "2024-05-15T10:30:00Z"
                productos:
                  - id: "prod_torta_01"
                    nombre: "Torta Tres Leches"
                    cantidad: 1
                    precio: 18500
                  - id: "prod_galleta_02"
                    nombre: "Caja Galletas Finas"
                    cantidad: 1
                    precio: 6500
        '404':
          description: Orden no encontrada

  /api/ordenes/{id}/estado:
    put:
      tags:
        - √ìrdenes
      summary: Actualizar estado de orden
      description: Servicio Firebase - CrudService.updateOrdenEstado()
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "orden_001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                estado:
                  type: string
                  enum: [pendiente, horneando, listo_retiro, completado, cancelado]
            example:
              estado: "listo_retiro"
      responses:
        '200':
          description: Estado actualizado correctamente
          content:
            application/json:
              example:
                success: true
                message: "Estado actualizado a listo_retiro"
        '404':
          description: Orden no encontrada

  /api/usuarios:
    get:
      tags:
        - Usuarios
      summary: Obtener lista de usuarios
      description: Servicio Firebase - CrudService.getUsuarios()
      responses:
        '200':
          description: Lista de usuarios obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Usuario'
              example:
                - id: "user_admin"
                  nombre: "Due√±a Pasteler√≠a"
                  email: "admin@pasteleria.com"
                  rol: "admin"
                  activo: true
                  telefono: "+56911112222"
                  direccion: "Calle Principal 1000"
                - id: "user_cli_01"
                  nombre: "Carlos Ruiz"
                  email: "carlos@gmail.com"
                  rol: "cliente"
                  activo: true
                  telefono: "+56987654321"

  /api/usuarios/{id}:
    get:
      tags:
        - Usuarios
      summary: Obtener usuario por ID
      description: Servicio Firebase - CrudService.getUsuarioById()
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: "user_cli_01"
      responses:
        '200':
          description: Usuario encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Usuario'
              example:
                id: "user_cli_01"
                nombre: "Carlos Ruiz"
                email: "carlos@gmail.com"
                rol: "cliente"
                activo: true
                telefono: "+56987654321"
                direccion: "Av. Los Alerces 456"
                createdAt: "2024-01-01T00:00:00Z"
        '404':
          description: Usuario no encontrado

  /api/categorias:
    get:
      tags:
        - Categor√≠as
      summary: Obtener lista de categor√≠as
      description: Servicio Firebase - CrudService.getCategorias()
      responses:
        '200':
          description: Lista de categor√≠as obtenida correctamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Categoria'
              example:
                - id: "cat_tortas"
                  nombre: "Tortas Tradicionales"
                  descripcion: "Tortas cl√°sicas como Tres Leches, Selva Negra, etc."
                  productosCount: 12
                  activa: true
                - id: "cat_sin_azucar"
                  nombre: "L√≠nea Sin Az√∫car"
                  descripcion: "Productos aptos para diab√©ticos"
                  productosCount: 5
                  activa: true
                - id: "cat_postres"
                  nombre: "Postres Individuales"
                  descripcion: "Mousse, tartaletas y pie de lim√≥n"
                  productosCount: 8
                  activa: true

components:
  schemas:
    EstadisticasDashboard:
      type: object
      properties:
        totalCompras:
          type: integer
          example: 45
        proyeccionCompras:
          type: integer
          example: 60
        totalProductos:
          type: integer
          example: 32
        inventarioTotal:
          type: integer
          example: 150
        totalUsuarios:
          type: integer
          example: 120
        nuevosUsuariosMes:
          type: integer
          example: 15

    Producto:
      type: object
      properties:
        id:
          type: string
        nombre:
          type: string
          example: "Torta de Hoja Manjar"
        precio:
          type: number
          example: 24500
        stock:
          type: integer
          example: 5
        categoria:
          type: string
          example: "Tortas"
        imagen:
          type: string
        activo:
          type: boolean
          example: true

    ProductoInput:
      type: object
      required:
        - nombre
        - precio
        - stock
      properties:
        nombre:
          type: string
        precio:
          type: number
        stock:
          type: integer
        categoria:
          type: string
        imagen:
          type: string

    Orden:
      type: object
      properties:
        id:
          type: string
        clienteNombre:
          type: string
        total:
          type: number
        estado:
          type: string
        fecha:
          type: string
          format: date-time
        productos:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nombre:
                type: string
              cantidad:
                type: integer
              precio:
                type: number

    Usuario:
      type: object
      properties:
        id:
          type: string
        nombre:
          type: string
        email:
          type: string
        rol:
          type: string
        activo:
          type: boolean
        telefono:
          type: string
        direccion:
          type: string
        createdAt:
          type: string
          format: date-time

    Categoria:
      type: object
      properties:
        id:
          type: string
        nombre:
          type: string
        descripcion:
          type: string
        productosCount:
          type: integer
        activa:
          type: boolean`;

        function launchSwaggerEditor() {
            const btn = document.getElementById('launchBtn');
            const loading = document.getElementById('loading');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            loading.style.display = 'block';
            status.innerHTML = 'Abriendo Swagger Editor...';
            
            try {
                const swaggerUrl = `https://editor.swagger.io/`;
                window.open(swaggerUrl, '_blank');
                
                status.innerHTML = 'Swagger Editor abierto. <br><strong>Por favor pega el contenido YAML manualmente.</strong>';
                status.style.color = '#333';
                
            } catch (error) {
                status.innerHTML = 'Error: ' + error.message;
                status.style.color = 'red';
            } finally {
                loading.style.display = 'none';
                setTimeout(() => {
                    btn.disabled = false;
                }, 2000);
            }
        }

        function copyYAMLContent() {
            const status = document.getElementById('status');
            
            try {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = openapiContent;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                tempTextArea.setSelectionRange(0, 99999); 
                
                const successful = document.execCommand('copy');
                document.body.removeChild(tempTextArea);
                
                if (successful) {
                    status.innerHTML = '<strong>¬°YAML copiado correctamente!</strong><br>Ahora p√©galo en Swagger Editor.';
                    status.style.color = 'green';
                } else {
                    throw new Error('Fallo en el comando copy');
                }
                
            } catch (error) {
                status.innerHTML = 'No se pudo copiar autom√°ticamente. <br>Copia el contenido manualmente desde el c√≥digo fuente.';
                status.style.color = 'red';
            }
        }
    </script>
</body>
</html>